// Detalles de cada curso
const courseDetails = {
clx: {
    title: "NOSOTROS",
    content: `
      <p>Somos un gran equipo sinérgico, multilingüe y multicultural, conformado por colaboradores responsables y comprometidos. 
      Nos apasiona compartir nuestra experiencia en cada curso, proyecto, alianza o servicio. 
      Trabajamos día a día para satisfacer a plenitud a quienes depositan su confianza en nosotros.</p><br>

      <p>Nuestra actividad se basa en los aportes de la de la Didáctica, de la Lingüística aplicada, de las Neurociencias, 
      asi como en los beneficios de la Virtualidad, de la Inteligencia Artificial y de la Mensajería instantánea, 
      sin olvidar nunca que somos y atendemos a Seres Humanos.<p>
    `,
  },

proximamente: {
    title: "PRÓXIMAMENTE",
    content: `
      <p>A partir del 15 de agosto, checa en este mismo link nuestra propuesta virtual y/o presencial para:</p>
      <ul>
        <li>LEX IT. Curso en autonomía mediante chatbot.</li>
        <li>Talleres (conversión, gramática, léxico y otros)</li>
        <li>Cursos semintensivos (1h30 diarias)</li>
        <li>Cursos intensivos (2h diarias)</li>
        <li>Cursos de comprensión de lectura</li>
        <li>Cursos por objetivos específicos</li>
        <li>Curso de preparación para exámenes de certificación</li>
        <li>Invierno virtual</li>
      </ul>
      `,
  },

 promocion: {
  title: "PROMO SORPRESA · 18-21 NOV",

  content: `
    <h4></h4>

    <p><strong>Válida únicamente del martes 18 al viernes 21 de noviembre.</strong></p>

    <p>Realiza tu registro en la pestaña <strong>INSCRIPCIONES</strong>.</p>

    <p>
      Cubre la <strong>inscripción ($350)</strong> y la <strong>colegiatura</strong> del:
    </p>

    <ul>
      <li><strong>Curso intensivo:</strong> de <s>$3000</s> → <strong>$2000</strong></li>
      <li><strong>Taller de conversación:</strong> de <s>$2000</s> → <strong>$1500</strong></li>
    </ul>

    <p><strong>Dudas? Contáctanos por WhatsApp:</strong></p>
    <p>
      <a href="tel:+525513404064"><strong>55 1340 4064</strong></a> /
      <a href="tel:+525573980411"><strong>55 7398 0411</strong></a>
    </p>
  `
},

intensivos: {
  title: 'Invierno 2025',
  content: `
    <h4>Cursos Virtuales Intensivos de Invierno</h4>

    <p><strong>Dirigido a:</strong><br>
    Comunidad universitaria UNAM (50% de descuento ya aplicado).</p>

    <p>Contamos con convenio vigente con la DGOAE para la <strong>Beca Idiomas UNAM</strong>.</p>

    <p><strong>Periodo:</strong><br>
    Diciembre 2025 – Enero 2026</p>

    <p><strong>Inscripciones:</strong><br>
    Del 10 de noviembre al 3 de diciembre. <strong>Cupo limitado.</strong></p>

    <p><strong>Duración:</strong></p>
    <ul>
      <li>Lunes a viernes: del <strong>8 de diciembre</strong> al <strong>30 de enero</strong>.</li>
      <li>Días de asueto: <strong>22 de diciembre al 4 de enero</strong>.</li>
      <li>Carga horaria: <strong>10 h/semana</strong> durante 6 semanas (<strong>60 h en total</strong>).</li>
    </ul>

    <p><strong>Cuotas de recuperación:</strong></p>
    <ul>
      <li><strong>Inscripción:</strong> $350</li>
      <li>
        <strong>Curso intensivo virtual (6 semanas):</strong> 
        <s>$3,000</s> → <strong>$2,000</strong> 
        <br><em>(Pagas $33.33 por hora de clase)</em>
      </li>
      <li><em>Nota:</em> El 50% de descuento UNAM ya está aplicado.</li>
    </ul>

    <p><strong>Cupo por grupo:</strong> mínimo 10, máximo 15 participantes</p>

    <p><strong>Incluye:</strong></p>
    <ul>
      <li>Material multimedia</li>
      <li>Constancia oficial al término del curso</li>
    </ul>

    <p><strong>Niveles ofertados:</strong><br>
    <strong>Inglés y Francés</strong> desde INTRO (00) hasta B2</p>

    <p><strong>Horarios disponibles:</strong></p>

    <h4>Inglés</h4>
    <ul>
      <li><strong>INTRO:</strong> 09:00–11:00 y 17:00–19:00</li>
      <li><strong>A1:</strong> 11:00–13:00</li>
      <li><strong>A2:</strong> 09:00–11:00 y 17:00–19:00</li>
      <li><strong>B1:</strong> 10:00–12:00, 17:00–19:00 y 19:00–21:00</li>
      <li><strong>B2:</strong> 20:00–22:00</li>
    </ul>

    <h4>Francés</h4>
    <ul>
      <li><strong>INTRO:</strong> 09:00–11:00 y 17:00–19:00</li>
      <li><strong>A1:</strong> 11:00–13:00</li>
      <li><strong>A2:</strong> 17:00–19:00</li>
      <li><strong>B1:</strong> 19:00–21:00</li>
      <li><strong>B2:</strong> 20:00–22:00</li>
    </ul>

    <p><strong>Otros idiomas:</strong><br>
    Para otros horarios, niveles o lenguas adicionales, regístrate en la <em>Lista de Espera</em>.</p>

    <p><strong>Examen de colocación:</strong></p>
    <ul>
      <li>Requerido para niveles superiores a INTRO (00).</li>
      <li>Costo: $150</li>
      <li>Solicítalo en la sección <strong>“Examen de Colocación”</strong>.</li>
    </ul>

    <p><strong>Importante:</strong></p>
    <ul>
      <li>Diseñado para un avance intensivo y equilibrado.</li>
      <li>Ideal para quienes desean avanzar en poco tiempo.</li>
      <li>Recomendado para participantes con alto nivel de compromiso.</li>
    </ul>

    <p><strong>¿Tienes dudas?</strong><br>
    Escríbenos por WhatsApp: 
    <a href="tel:+525573980411">55 7398 0411</a>
    </p>
  `
},

regulares: {
    title: "CURSOS <strong>REGULARES</strong> VIRTUALES 2025",
    content: `
      <h4>CURSOS VIRTUALES REGULARES - UNAM</h4>
    `
  },

talleres: {
  title: 'Invierno 2025',
  content: `
    <h4>Taller Virtual de <em>Conversación</em></h4>

    <p><strong>Dirigido a:</strong><br>
    Comunidad universitaria UNAM (50% de descuento ya aplicado).</p>

    <p>Contamos con convenio vigente con la DGOAE para la <strong>Beca Idiomas UNAM</strong>.</p>

    <p><strong>Periodo:</strong><br>
    Diciembre 2025 – Enero 2026</p>

    <p><strong>Inscripciones:</strong><br>
    Del <strong>18 al 21 de noviembre</strong>. PROMO Sorpresa. <strong>Cupo limitado</strong>.</p>

    <p><strong>Duración:</strong></p>
    <ul>
      <li>Lunes a viernes: del <strong>8 de diciembre</strong> al <strong>30 de enero</strong>.</li>
      <li>Días de asueto: <strong>22 de diciembre al 4 de enero</strong>.</li>
      <li>Carga horaria: <strong>5 h/semana</strong> durante 6 semanas (30 h en total).</li>
    </ul>

    <p><strong>Cuotas de recuperación:</strong></p>
    <ul>
      <li><strong>Inscripción:</strong> $350</li>
      <li>
        <strong>Taller virtual (6 semanas):</strong> 
        <s>$2,000</s> → <strong>$1,500</strong>
        <br><em>(Pagas $50 por hora de clase)</em>
      </li>
      <li><em>Nota:</em> Descuento UNAM ya aplicado.</li>
    </ul>

    <p><strong>Cupo por grupo:</strong> mínimo 6, máximo 12 participantes</p>

    <p><strong>Incluye:</strong></p>
    <ul>
      <li>Material multimedia</li>
      <li>Constancia oficial al término del taller</li>
    </ul>

    <p><strong>Idiomas disponibles:</strong> Inglés y Francés</p>

    <p><strong>Niveles y horarios:</strong></p>

    <h4>Inglés</h4>
    <ul>
      <li><strong>A1:</strong> 10:00–11:00 y 18:00–19:00</li>
      <li><strong>A2:</strong> 11:00–12:00 y 17:00–18:00</li>
      <li><strong>B1:</strong> 10:00–11:00 y 17:00–18:00</li>
      <li><strong>B2:</strong> 20:00–21:00</li>
    </ul>

    <h4>Francés</h4>
    <ul>
      <li><strong>A1:</strong> 10:00–11:00 y 18:00–19:00</li>
      <li><strong>A2:</strong> 11:00–12:00 y 17:00–18:00</li>
      <li><strong>B1:</strong> 10:00–11:00 y 17:00–18:00</li>
      <li><strong>B2:</strong> 20:00–21:00</li>
    </ul>

    <p><strong>Otros idiomas:</strong><br>
    Para otros horarios, niveles o lenguas, regístrate en la <em>Lista de Espera</em>.</p>

    <p><strong>Examen de colocación:</strong><br>
    <em>No es necesario.</em> Solo presenta comprobante del último nivel cursado.</p>

    <p><strong>¿Tienes dudas?</strong><br>
    WhatsApp: <a href="tel:+525573980411">55 7398 0411</a></p>
  `
},

lectura: {
    title: "Comprensión de lectura",
    content: `
      <p>Enfocado en desarrollar habilidades de lectura, análisis de textos y ampliación de vocabulario. 
      Lecturas auténticas adaptadas a tu nivel.</p>
    `,
  },

contacto: {
    title: "CONTACTO",
    content: `
      <p>
         <p>Comunícate con nosotros, te atenderemos lo más pronto posible</p>
        <a href="mailto:contacto@clx.com">
          <i class="fas fa-envelope"></i>contacto@clx.com.mx
        </a><br>  
        <a href="tel:+525513404064">
          <i class="fab fa-whatsapp"></i>55 1340 4064<br>
        </a>
        <a href="tel:+525573980411">
          <i class="fab fa-whatsapp"></i>55 7398 0411
        </a>
      </p>
  
      <p><strong>Síguenos en redes sociales:</strong></p>
      <ul class="social-links">
        <li>
          <a href="https://www.facebook.com/clxidiomas" target="_blank">
            <i class="fab fa-facebook-f"></i>Facebook
          </a>
        </li>
        <li>
          <a href="https://www.instagram.com/clx_idiomas/" target="_blank">
            <i class="fab fa-instagram"></i>Instagram
          </a>
        </li>
      </ul>
  
      <p>
        <strong>Página oficial:</strong><br>
        <a href="https://www.clx.com.mx" target="_blank">
          <i class="fas fa-globe"></i>https://www.clx.com.mx
        </a>
      </p>
    `,
  },

  // Formulario de inscripción
inscripcion: {
    title: "INSCRIPCIONES",
    content: `
      <form id="form-inscripcion" class="inscription-form">
        <h4>Formulario de Inscripción</h4>
        <div id="insc-announcement" class="announcement">
          ⚠️ ¡IMPORTANTE! Abrimos un grupo con al menos 6 alumnos inscritos.<br><br>
          Te recomendamos considerar un horario que ya tenga alumnos inscritos o bien reflexionar sobre otras posibilidades de horario o cambio de idioma (si eres principiante)<br>
        </div>
        <!-- Campos básicos -->
        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input id="nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
        </div>
        <div class="form-group">
          <label for="cuenta_unam">No. de Cuenta/Empleado UNAM</label>
          <input id="cuenta_unam" name="cuenta_unam" type="text" placeholder="Ej: 12345678">
        </div>
        <div class="form-group">
          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="usuario@correo.com" required>
        </div>
        <div class="form-group">
          <label for="whatsapp">WhatsApp</label>
          <input id="whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
        </div>

        <!-- Select tipo → idioma → nivel → horario -->
        <div class="form-group">
          <label for="tipo_curso">Tipo de curso</label>
          <select id="tipo_curso" name="tipo_curso" required>
            <option value="" disabled selected>Elige un tipo…</option>
            <!--<option value="regular">Regular</option>-->
            <option value="intensivo">Intensivo</option>
            <option value="taller">Taller de conversación</option>
          </select>
        </div>
        <div class="form-group">
          <label for="idioma">Idioma</label>
          <select id="idioma" name="idioma" required>
            <option value="" disabled selected>Selecciona primero tipo…</option>
          </select>
        </div>
        <div class="form-group">
          <label for="nivel_ingreso">Nivel de ingreso</label>
          <select id="nivel_ingreso" name="nivel_ingreso" required>
            <option value="" disabled selected>Selecciona primero idioma…</option>
          </select>
        </div>
        <div class="form-group">
          <label for="horario">Horario</label>
          <select id="horario" name="horario" required>
            <option value="" disabled selected>Selecciona primero nivel…</option>
          </select>
          <div class="inscritos-info">
            Inscritos en este horario: <span id="inscritos-count-inline">0</span>
          </div>
        </div>
        <div class="form-group" id="horario-otro-group" style="display:none;">
          <label for="horario_otro">Proponer horario</label>
          <input id="horario_otro" name="horario_otro" type="text" placeholder="Escribe tu horario…">
        </div>

        <!-- Selección de periodo -->
        <div class="form-group" id="periodo-group" style="display:none;">
          <label><strong>Periodo del curso</strong></label>
          <div id="periodo-options"></div>
          <input type="hidden" id="fecha_inicio" name="fecha_inicio" required>
          <input type="hidden" id="fecha_fin" name="fecha_fin" required>
        </div>

        <!-- Confirmación -->
        <div class="form-group">
          <input id="confirm_periodo" name="confirm_periodo" type="checkbox" required>
          <label for="confirm_periodo">Confirmo que el periodo seleccionado es correcto</label>
        </div>

        <!-- Mensaje y envío -->
        <div class="form-group full-width">
          <label for="mensaje">Mensaje (opcional)</label>
          <textarea id="mensaje" name="mensaje"
                    placeholder="Escribe tu solicitud de horario, dudas o comentarios aquí…"></textarea>
        </div>

        <button type="submit">Enviar Inscripción</button>
        <div id="insc-feedback" role="alert"></div>
      </form>
    `,
  },

examen: {
    title: "EXAMEN DE COLOCACIÓN",
    content: `
    <form id="form-examen-colocacion" class="examen-form">
    <h4>Registro Examen de Colocación</h4>

    <div class="form-group">
      <label for="ex_nombre">Nombre</label>
      <input id="ex_nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
    </div>

    <div class="form-group">
      <label for="ex_cuenta">No. de Cuenta/Empleado UNAM</label>
      <input id="ex_cuenta" name="cuenta_unam" type="text" placeholder="Ej: 12345678" required>
    </div>

    <div class="form-group">
      <label for="ex_whatsapp">WhatsApp</label>
      <input id="ex_whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
    </div>

    <div class="form-group">
      <label for="ex_email">E-mail</label>
      <input id="ex_email" name="email" type="email" placeholder="usuario@correo.com" required>
    </div>

    <div class="form-group">
      <label for="ex_idioma">Idioma</label>
      <select id="ex_idioma" name="idioma" required>
        <option value="" disabled selected>Selecciona idioma…</option>
        <option value="ingles">Inglés</option>
        <option value="frances">Francés</option>
      </select>
    </div>

    <button type="submit">Enviar Registro</button>
  </form>

  <div id="ex-feedback" role="alert"></div>

  <p class="note">
    * En breve un ejecutivo se pondrá en contacto contigo para darle seguimiento al proceso de presentación de examen de colocación.
  </p>`,
  },

lista: {
  title: "LISTA DE ESPERA",
  content: `
    <form id="form-lista-espera" class="lista-espera-form">
      <h4>Registro Lista de Espera</h4>

      <div class="form-group">
        <label for="le_nombre">Nombre</label>
        <input id="le_nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
      </div>

      <div class="form-group">
        <label for="le_cuenta">No. de Cuenta/Empleado UNAM</label>
        <input id="le_cuenta" name="cuenta_unam" type="text" placeholder="Ej: 12345678" required>
      </div>

      <div class="form-group">
        <label for="le_whatsapp">WhatsApp</label>
        <input id="le_whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
      </div>

      <div class="form-group">
        <label for="le_email">E-mail</label>
        <input id="le_email" name="email" type="email" placeholder="usuario@correo.com" required>
      </div>

      <div class="form-group">
        <label for="le_idioma">Idioma</label>
        <select id="le_idioma" name="idioma" required>
          <option value="" disabled selected>Selecciona idioma…</option>
          <option value="ingles">Inglés</option>
          <option value="frances">Francés</option>
          <option value="aleman">Alemán</option>
          <option value="italiano">Italiano</option>
          <option value="portugues">Portugués</option>
          <option value="japones">Japonés</option>
          <option value="chino">Chino</option>
          <option value="coreano">Coreano</option>
          <option value="esp_extranjeros">Español para extranjeros</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="form-group">
        <label for="le_nivel">Nivel</label>
        <select id="le_nivel" name="nivel" required>
          <option value="" disabled selected>Selecciona nivel…</option>
          <option value="A2">A2</option>
          <option value="B1">B1</option>
          <option value="B2">B2</option>
        </select>
      </div>

      <div class="form-group">
        <label for="le_horario">Horario deseado</label>
        <select id="le_horario" name="horario_deseado" required>
          <option value="" disabled selected>Selecciona horario…</option>
          <option value="por la mañana">Por la mañana</option>
          <option value="a media tarde">A media tarde</option>
          <option value="por la noche">Por la noche</option>
          <option value="fin de semana">En fin de semana</option>
        </select>
      </div>

      <button type="submit">Enviar Solicitud</button>
    </form>

    <div id="le-feedback" role="alert"></div>

    <p class="note">
      * En breve un ejecutivo se pondrá en contacto contigo para darle seguimiento a tu solicitud.
    </p>
  `,
},
};

// 2) DOMContentLoaded: menú lateral + renderizado dinámico
// ————————————————————————————————
document.addEventListener("DOMContentLoaded", () => {
  const rects   = document.querySelectorAll(".course-menu .rect");
  const infoBox = document.getElementById("course-info");

  rects.forEach(rect => {
    rect.addEventListener("click", () => {
      // 1) Desactivar todos
      rects.forEach(r => r.classList.remove("active"));
      // 2) Activar el clicado
      rect.classList.add("active");

      // 3) Renderizar contenido
      const key  = rect.id;
      const data = courseDetails[key];
      infoBox.innerHTML = `<h3>${data.title}</h3>${data.content}`;

      // 4) Si es Inscripción, inicializar TODO
      if (key === "inscripcion") {
        bindFormLogic();
        populatePeriodos();
        attachInscriptionHandler();
        // fuerza el primer change para poblar el select
        document.getElementById("tipo_curso")
                .dispatchEvent(new Event("change"));
      }

      // 5) Si es Examen de Colocación, engancha el AJAX handler
      if (key === "examen") {
        attachExamHandler();
      }

      // 6) Si es Lista de Espera, engancha el AJAX handler
      if (key === "lista") {
        attachListaHandler();
      }

      // 7) Scroll suave
      infoBox.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  });
});

// Diccionario de idiomas
const languageLabels = {
  ingles: "Inglés",
  frances: "Francés",
  aleman: "Alemán",
  italiano: "Italiano",
  portugues: "Portugués",
  japones: "Japonés",
  chino: "Chino",
  coreano: "Coreano",
};

// ————————————————————————————————
// 3) availability: curso → idiomas → niveles → horarios (strings) o bloques { dias, horas }
// ————————————————————————————————
const availability = {
  intensivo: {
    idiomas: {
    ingles: {
      INTRO: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["09:00-11:00", "17:00-19:00"],
        },
      ],
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["11:00-13:00",],
        },
      ],
      A2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["09:00-11:00", "17:00-19:00",],
        },
      ],
      B1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["10:00-12:00", "17:00-19:00", "19:00-21:00"],
        },
      ],
      B2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["20:00-22:00"],
        },
      ],
    },
    frances: {
      INTRO: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["09:00-11:00", "17:00-19:00"],
        },
      ],
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["11:00-13:00",],
        },
      ],
      A2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["17:00-19:00",],
        },
      ],
      B1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["19:00-21:00"],
        },
      ],
      B2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["20:00-22:00"],
        },
      ],
    },
    /*
    aleman: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },
    italiano: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },
    portugues: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },*/
  },
  },
  regular: {
  idiomas: {
    ingles: {
      'A1': [
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: ['07:00-08:00','08:00-09:00',],
        },
        {
          dias: ['Sáb', 'Dom'],
          horas: ['07:00-09:30','08:00-10:30','09:30-12:00','10:30-13:00','19:00-21:30'],
        }
      ]
    },
    frances: {
      'A1': [
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: ['07:00-08:00','08:00-09:00',],
        },
        {
          dias: ['Sáb', 'Dom'],
          horas: ['07:00-09:30','08:00-10:30','09:30-12:00','10:30-13:00','19:00-21:30'],
        }
      ]
    },
    italiano: {
      'A1': [
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: ['07:00-08:00','08:00-09:00',],
        },
        {
          dias: ['Sáb', 'Dom'],
          horas: ['07:00-09:30','08:00-10:30','09:30-12:00','10:30-13:00','19:00-21:30'],
        }
      ]
    },

    aleman: {
      'A1': [
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: ['07:00-08:00','08:00-09:00',],
        },
        {
          dias: ['Sáb', 'Dom'],
          horas: ['07:00-09:30','08:00-10:30','09:30-12:00','10:30-13:00','19:00-21:30'],
        }
      ]
    }
  }
},
  taller: {
    idiomas: {
      ingles: {
        A1: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["10:00-11:00", "18:00-19:00",],
          },
        ],
        A2: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["11:00-12:00", "17:00-18:00",],
          },
        ],
        B1: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["10:00-11:00", "17:00-18:00",],
          },
        ],
        B2: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["20:00-21:00"],
          },
        ],
      },
      frances: {
        A1: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["10:00-11:00", "18:00-19:00",],
          },
        ],
        A2: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["11:00-12:00", "17:00-18:00",],
          },
        ],
        B1: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["10:00-11:00", "17:00-18:00",],
          },
        ],
        B2: [
          {
            dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
            horas: ["20:00-21:00"],
          },
        ],
      },
    },
    },
  /*
  iniciacion: {
  idiomas: {
    aleman: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['18:00-19:00'] }
      ]
    },
    arabe: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['19:00-20:00'] }
      ]
    },
    coreano: {
      A1: [
        { dias: ['Mar','Jue'], horas: ['9:00-10:30'] }
      ]
    },
    chino: {
      A1: [
        { dias: ['Lun','Mié','Jue'], horas: ['19:00-20:00'] }
      ]
    },
    
    frances: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['18:00-19:00',] }, 
      ]
    },
    italiano: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['15:00-16:00'] }
      ]
    },
    japones: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['17:00-18:00'] }
      ]
    },
    portugues: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['11:00-12:00'] }
      ]
    }
  }
},*/
};

// ————————————————————————————————
// 4) populatePeriodos: radios de periodo según tipo_curso
// ————————————————————————————————
function populatePeriodos() {
  const tipo = document.getElementById("tipo_curso").value;
  const cont = document.getElementById("periodo-options");
  const grp = document.getElementById("periodo-group");
  let opts = [];

  if (tipo === "intensivo" || tipo === "taller") {
    opts = [{ label: "08 diciembre - 30 enero", start: "2025-12-08", end: "2026-01-30" }];
  } else if (tipo === "regular") {
    opts = [
      { label: "8 septiembre - 26 noviembre", start: "2025-09-08", end: "2025-11-26" },
    ];
  } else if (tipo === "iniciacion") {
    opts = [{ label: "4 - 31 julio", start: "2025-07-04", end: "2025-07-31" }];
  }

  if (!opts.length) {
    grp.style.display = "none";
    return;
  }
  grp.style.display = "block";

  cont.innerHTML = opts
    .map(
      (o, i) => `
    <div class="radio-option">
      <input type="radio" id="periodo_${i}" name="periodo" 
             value="${o.start}|${o.end}" required>
      <label for="periodo_${i}">${o.label}</label>
    </div>
  `
    )
    .join("");

  opts.forEach((o, i) => {
    document.getElementById(`periodo_${i}`).addEventListener("change", (e) => {
      const [s, f] = e.target.value.split("|");
      document.getElementById("fecha_inicio").value = s;
      document.getElementById("fecha_fin").value = f;
    });
  });

  // auto-select si sólo hay uno
  const r = cont.querySelectorAll('input[type="radio"]');
  if (r.length === 1) {
    r[0].checked = true;
    r[0].dispatchEvent(new Event("change"));
  }
}

// ————————————————————————————————
// 5) bindFormLogic: manejamos selects y “otro…” + fetch de count
// ————————————————————————————————
function bindFormLogic() {
  const form = document.getElementById("form-inscripcion");
  const tipo = form.tipo_curso;
  const idioma = form.idioma;
  const nivel = form.nivel_ingreso;
  const horario = form.horario;
  const otroGrp = document.getElementById("horario-otro-group");
  const otroInp = document.getElementById("horario_otro");
  const inlineCount = document.getElementById("inscritos-count-inline");

  const placeholder = txt => `<option value="" disabled selected>${txt}</option>`;

  tipo.addEventListener("change", () => {
    const langs = Object.keys(availability[tipo.value]?.idiomas || {});
    idioma.innerHTML = langs.length
      ? [placeholder("Selecciona un idioma…"), ...langs.map(l => {
          const label = languageLabels[l] || l;
          return `<option value="${l}">${label}</option>`;
        })].join("")
      : placeholder("Selecciona tipo primero…");
    nivel.innerHTML = placeholder("Idioma primero…");
    horario.innerHTML = placeholder("Nivel primero…");
    populatePeriodos();
  });

  idioma.addEventListener("change", () => {
    const lvls = Object.keys(availability[tipo.value]?.idiomas[idioma.value] || {});
    nivel.innerHTML = lvls.length
      ? [placeholder("Selecciona un nivel…"), ...lvls.map(v => `<option value="${v}">${v}</option>`)].join("")
      : placeholder("Primero elige idioma…");
    horario.innerHTML = placeholder("Nivel primero…");
  });

  nivel.addEventListener("change", () => {
    const conf = availability[tipo.value]?.idiomas[idioma.value]?.[nivel.value] || [];
    populateHorarios(conf, horario, placeholder);
  });

  
  horario.addEventListener("change", () => {
    if (horario.value === "otro") {
      otroGrp.style.display = "block";
      otroInp.required = true;
      return;
    }
    otroGrp.style.display = "none";
    otroInp.required = false;
    otroInp.value = "";

    const params = new URLSearchParams({
      tipo_curso: tipo.value,
      idioma: idioma.value,
      nivel_ingreso: nivel.value,
      horario: horario.value
    });
    fetch(`/api/inscripciones/count/?${params}`)
      .then(r => r.json())
      .then(json => inlineCount.textContent = json.count)
      .catch(() => inlineCount.textContent = "0");
  });

  tipo.dispatchEvent(new Event("change"));
}

// 6) populateHorarios: construye <option> de horarios
function populateHorarios(conf, selectEl, placeholder) {
  let opts = [placeholder("Selecciona un horario…")];
  if (conf.length && typeof conf[0] === "string") {
    conf.forEach(h => opts.push(`<option value="${h}">${h}</option>`));
  } else {
    conf.forEach(block => {
      block.horas.forEach(h => {
        opts.push(`<option value="${h}">${block.dias.join(", ")} — ${h}</option>`);
      });
    });
  }
  // -------- Activar para proponer otro horario --------
  //opts.push('<option value="otro">Otro…</option>');
  selectEl.innerHTML = opts.join("");
}

// 7) attachInscriptionHandler: AJAX de inscripción
function attachInscriptionHandler() {
  const form     = document.getElementById("form-inscripcion");
  const feedback = document.getElementById("insc-feedback");
  const btn      = form.querySelector('button[type="submit"]');

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";
    btn.disabled = true;

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/inscripcion/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.classList.add("success");
      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
      btn.disabled = false;
    }
  });
}

// 8) attachExamHandler: AJAX de examen de colocación
function attachExamHandler() {
  const form     = document.getElementById("form-examen-colocacion");
  const feedback = document.getElementById("ex-feedback");

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/examen-colocacion/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
    }
  });
}

// 9) attachListaHandler: AJAX de lista de espera
function attachListaHandler() {
  const form     = document.getElementById("form-lista-espera");
  const feedback = document.getElementById("le-feedback");

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/lista-espera/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
    }
  });
}
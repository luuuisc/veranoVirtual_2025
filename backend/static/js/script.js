// Detalles de cada curso
const courseDetails = {
clx: {
    title: "NOSOTROS",
    content: `
      <p>Somos un gran equipo sinérgico, multilingüe y multicultural, conformado por colaboradores responsables y comprometidos. 
      Nos apasiona compartir nuestra experiencia en cada curso, proyecto, alianza o servicio. 
      Trabajamos día a día para satisfacer a plenitud a quienes depositan su confianza en nosotros.</p><br>

      <p>Nuestra actividad se basa en los aportes de la de la Didáctica, de la Lingüística aplicada, de las Neurociencias, 
      asi como en los beneficios de la Virtualidad, de la Inteligencia Artificial y de la Mensajería instantánea, 
      sin olvidar nunca que somos y atendemos a Seres Humanos.<p>
    `,
  },

proximamente: {
    title: "PRÓXIMAMENTE",
    content: `
      <p>A partir del 15 de agosto, checa en este mismo link nuestra propuesta virtual y/o presencial para:</p>
      <ul>
        <li>LEX IT. Curso en autonomía mediante chatbot.</li>
        <li>Talleres (conversión, gramática, léxico y otros)</li>
        <li>Cursos semintensivos (1h30 diarias)</li>
        <li>Cursos intensivos (2h diarias)</li>
        <li>Cursos de comprensión de lectura</li>
        <li>Cursos por objetivos específicos</li>
        <li>Curso de preparación para exámenes de certificación</li>
        <li>Invierno virtual</li>
      </ul>
      `,
  },

intensivos: {
    title: "Intensivos - Verano 2025",
    content: `
       <h4>
    <span class="small">Cursos</span>
    <span class="medium">VIRTUALES</span>
    <span class="large">INTENSIVOS</span>
  </h4>
  <p><strong>Para la comunidad UNAM</strong></p>
  <p><strong>Periodo:</strong> Agosto - Octubre 2025</p>

  <p><strong>INSCRIPCIONES:</strong><br>
     Del 1 al 13 de agosto. Cupo limitado.</p>

  <p><strong>DURACIÓN:</strong><br>
     Del 18 de agosto al 27 de octubre<br>
     (5 horas por semana durante 10 semanas)</p>

  <p><strong>ALCANCE:</strong><br>
     Se avanza un nivel oficial al cabo de 60 horas de clase en tiempo real y aproximadamente 120 horas de tareas extra clase.</p>

  <p><strong>HORARIOS:</strong></p>
  <ul>
    <li><strong>I. Lunes a viernes</strong>
      <ul>
        <li><strong>INGLÉS A1 (desde 00)</strong><br>
            7-8 hrs<br>
            8-9 hrs<br>
            14-15 hrs<br>
            17-18 hrs<br>
            20-21 hrs
        </li>
        <li><strong>INGLÉS A2</strong><br>
            7-8 hrs<br>
            13-14 hrs<br>
            20-21 hrs
        </li>
        <li><strong>INGLÉS B1</strong><br>
            13-14 hrs<br>
            21-22 hrs
        </li>
        <li><strong>INGLÉS B2</strong><br>
            21-22 hrs
        </li>
        <li><strong>FRANCÉS A1 (desde 00)</strong><br>
            7-8 hrs<br>
            8-9 hrs<br>
            17-18 hrs<br>
            20-21 hrs
        </li>
        <li><strong>FRANCÉS A2</strong><br>
            7-8 hrs<br>
            13-14 hrs<br>
            21-22 hrs
        </li>
      </ul>
    </li>
    <li><strong>II. Sábados y domingos</strong>
      <ul>
        <li><strong>INGLÉS A1 (desde 00)</strong><br>
            8-11 hrs<br>
            11-14 hrs<br>
            19:30-22 hrs
        </li>
        <li><strong>INGLÉS A2</strong><br>
            8-11 hrs<br>
            11-14 hrs<br>
            19:30-22 hrs
        </li>
        <li><strong>INGLÉS B1</strong><br>
            8-11 hrs<br>
            11-14 hrs<br>
            19:30-22 hrs
        </li>
        <li><strong>FRANCÉS A1 (desde 00)</strong><br>
            8-11 hrs<br>
            11-14 hrs<br>
            19:30-22 hrs
        </li>
        <li><strong>FRANCÉS A2</strong><br>
            8-11 hrs<br>
            11-14 hrs<br>
            19:30-22 hrs
        </li>
      </ul>
    </li>
  </ul>

  <p><strong>IMPORTANTE:</strong></p>
  <ul>
    <li>Si deseas inscribirte a un nivel u horario diferente de inglés o francés, así como a otro idioma (alemán, italiano, portugués, japonés, chino, coreano, español para extranjeros u otro), ingresa a la sección <strong>“LISTA DE ESPERA”</strong>.</li>
    <li>El periodo de inscripción a estos cursos es del 10 al 25 de junio; el cupo por grupo es de 6 a 15 alumnos máximo.</li>
    <li>La inscripción es de <strong>$250</strong> y la colegiatura para el curso <strong>INTENSIVO</strong> de 10 semanas es de <strong>$3,000</strong>.</li>
    <li>El cupo por grupo es de mínimo 6, máximo 12 participantes.</li>
    <li>Incluye material multimedia.</li>
    <li>Al final del curso se otorga una constancia de equivalencia de nivel oficial internacional, si se obtiene un promedio mínimo de 8.</li>
  </ul>

  <section id="examen-colocacion-intensivo" class="info-block">
    <h3>EXAMEN DE COLOCACIÓN</h3>
    <p>Para ingresar a los niveles A2, B1 o B2 es necesario presentar un examen de colocación cuyo costo es de <strong>$150</strong>, o bien, una constancia que acredite el nivel inmediato anterior.<br>
    Para tramitar dicho examen ingresa a la sección <strong>“EXAMEN DE COLOCACIÓN”</strong>.</p>
  </section>
    `
  },
  "semi-intensivos": {
    title: "Semi intensivos",
    content: `
      <p>Clases 3 veces por semana durante 8 semanas. 
      Equilibrio perfecto entre ritmo acelerado y tiempo para asimilar contenidos.</p>
    `,
  },
  regulares: {
    title: "CURSOS <strong>REGULARES</strong> VIRTUALES 2025",
    content: ` 
<section>
  <h3><strong>para la comunidad UNAM</strong></h3>
  <p><strong>Periodo:</strong> Agosto - Noviembre 2025</p>

  <h3><strong>INSCRIPCIONES:</strong></h3>
  <p>Del 6 al 22 de agosto. Cupo limitado.</p>

  <h3><strong>DURACIÓN:</strong></h3>
  <ul>
    <li><strong>Lunes a viernes:</strong> Del 8 de septiembre al 26 de noviembre. (Días de asueto: 15 y 16 de septiembre, 17 de noviembre)</li>
    <li><strong>Sábados y domingos:</strong> Del 13 de septiembre al 30 de noviembre. (Días de asueto: 2 de noviembre)</li>
    <li><strong>Carga horaria</strong> de 5 horas semanales durante 12 semanas, es decir, un total de 60 horas.</li>
  </ul>

  <h3><strong>CUOTAS DE RECUPERACIÓN:</strong></h3>
  <ul>(El <strong>50% de descuento</strong> para la comunidad UNAM ya está aplicado)</ul>
  <ul>
    <li>Inscripción: <strong>$250</strong></li>
    <li>Curso regular virtual (12 semanas): <strong>$3000</strong></li>
    <li>Cupo por grupo: mínimo 6, máximo 12 personas</li>
    <li>Incluye material multimedia y constancia oficial (mínimo 8 de promedio)</li>
  </ul>

  <h3><strong>HORARIOS DISPONIBLES</strong></h3>

  <h4><strong>De lunes a viernes</strong></h4>
  <ul>
    <li><strong>Inglés A1:</strong> 7-8, 8-9, 11-12, 14-15, 17-18, 18-19, 19-20, 20-21 hrs</li>
    <li><strong>Francés A1:</strong> 7-8, 8-9, 13-14, 18-19, 20-21 hrs</li>
    <li><strong>Italiano A1:</strong> 8-9, 15-16, 18-19, 19-20 hrs</li>
  </ul>

  <h4><strong>Sábados y domingos</strong></h4>
  <ul>
    <li><strong>Inglés A1:</strong> 7-9:30, 8-10:30, 9:30-12, 10:30-13, 19-21:30 hrs</li>
    <li><strong>Francés A1:</strong> 7-9:30, 8-10:30, 19:30-22 hrs</li>
    <li><strong>Alemán A1:</strong> 19:30-22 hrs</li>
    <li><strong>Italiano A1:</strong> 8-10:30 hrs</li>
  </ul> 

  <h3><strong>OTROS IDIOMAS:</strong></h3>
  <p>Para horarios/niveles distintos o cursos en <strong>portugués, japonés, chino, coreano, español para extranjeros</strong>, consulta la sección <strong>“LISTA DE ESPERA”</strong>.</p>

  <h3><strong>EXAMEN DE COLOCACIÓN:</strong></h3>
  <p>Requerido para ingresar a niveles A2, B1 o B2. Costo: <strong>$150</strong>. También puedes presentar constancia del nivel anterior.<br>
  Tramita tu examen en la sección <strong>“EXAMEN DE COLOCACIÓN”</strong>.</p>

  <h3><strong>¿TIENES DUDAS?</strong></h3>
  <p>Escríbenos por WhatsApp: <a href="https://wa.me/525573980411"><strong>55 7398 0411</strong></a></p>
</section>`,
  },
  "ini-prepa": {
    title: "Iniciación - Verano 2025",
    content: `
    <h4>CURSOS virtuales <strong>DE INICIACIÓN</strong> a una lengua  extranjera, para la <strong>Comunidad  UNAM</strong>, idealmente de 15 años en adelante.</h4>

    <p><strong>DURACIÓN :</strong><br>
    ( Del 4 al 31 de <strong>JULIO</strong> : 12 horas en total )</p>

    <p><strong>HORARIOS :</strong></p>
    <ul>
      <li><strong>ALEMÁN</strong><br>
          Lunes, miércoles y viernes de 18 a 19 hrs
      </li>
      <li><strong>ARABE</strong><br>
          Lunes, miércoles y viernes de 19-20 hrs
      </li>
      <li><strong>COREANO</strong><br>
          Martes y jueves de 9-10:30 hrs
      </li>
      <li><strong>FRANCÉS</strong><br>
          Lunes, miércoles y viernes de 18 a 19 hrs
      </li>
      <li><strong>ITALIANO</strong><br>
          Lunes, miércoles y viernes de 15 a 16 hrs
      </li>
      <li><strong>JAPONÉS</strong><br>
          Lunes, miércoles y viernes de 17 a 18 hrs
      </li>
      <li><strong>PORTUGUÉS</strong><br>
          Lunes, miércoles y viernes de 11-12 hrs
      </li>
    </ul>

    <p><strong>ALCANCE</strong><br>
    En cuatro semanas lograrás adquirir una percepción general de la lengua extranjera que hayas elegido para decidir posteriormente y con mayor certeza, si deseas iniciar el estudio formal de la misma...</p>

    <p><strong>PERIODO DE INSCRIPCIONES</strong><br>
    El periodo de inscripción a estos cursos es del 10 al 20 de junio, el cupo por grupo es de 6 a 12 alumnos máximo.</p>

    <p>La inscripción es de <strong>$250</strong> y la colegiatura por el curso de 12 horas es de <strong>$600</strong> ( ya está aplicado el 50% de descuento para la comunidad UNAM ).</p>

    <p>En el llenado de la ficha de inscripción, favor de anotar los datos de quien tomará el curso, no de quien l@ inscribe.</p>

    <p><strong>IMPORTANTE :</strong><br>
    Enviar los siguientes datos vía WhatsApp al <a href="https://wa.me/525513404064" target="_blank">55 1340 4064</a> :</p>
    <ol>
      <li>Nombre completo de quien tomará el curso :</li>
      <li>Nombre completo y número de teléfono del padre o tutor, si quien va a tomar el curso es menor a 18 años :</li>
      <li>Idioma :</li>
      <li>Nivel :</li>
      <li>Horario :</li>
      <li>Foto o captura del depósito o transferencia de la inscripción y colegiatura. ( Total <strong>$850</strong> )</li>
    </ol>

    <p><strong>CUPO POR GRUPO :</strong><br>
    Mínimo 6, máximo 12 participantes</p>

    <p><strong>INCLUYE :</strong></p>
    <ul>
      <li>Material multimedia</li>
      <li>Constancia de participación</li>
    </ul>

    <p><strong>A CONSIDERAR...</strong><br>
    Este curso te permitirá:</p>
    <ul>
      <li>Descubrir si ese idioma que te llama la atención puede ser parte de tu camino.</li>
      <li>Aprender frases útiles y expresiones básicas desde el primer día.</li>
      <li>Explorar costumbres, música, gastronomía y escritura de otras culturas.</li>
      <li>Dar el primer paso hacia una formación global y un perfil internacional.</li>
      <li>Tener una experiencia enriquecedora que puedes continuar más adelante.</li>
    </ul>
  `,
  },
  "ini-ninos": {
    title: "Iniciación (Niños 6-10 años)",
    content: `
      <p>Clases lúdicas y didácticas para niños de 6 a 10 años. 
      Juegos, canciones y proyectos divertidos para un aprendizaje natural.</p>
    `,
  },
  lectura: {
    title: "Comprensión de lectura",
    content: `
      <p>Enfocado en desarrollar habilidades de lectura, análisis de textos y ampliación de vocabulario. 
      Lecturas auténticas adaptadas a tu nivel.</p>
    `,
  },
  contacto: {
    title: "CONTACTO",
    content: `
      <p>
         <p>Comunícate con nosotros, te atenderemos lo más pronto posible</p>
        <a href="mailto:contacto@clx.com">
          <i class="fas fa-envelope"></i>contacto@clx.com
        </a><br>  
        <a href="tel:+525513404064">
          <i class="fab fa-whatsapp"></i>55 1340 4064<br>
        </a>
        <a href="tel:+525573980411">
          <i class="fab fa-whatsapp"></i>55 7398 0411
        </a>
      </p>
  
      <p><strong>Síguenos en redes sociales:</strong></p>
      <ul class="social-links">
        <li>
          <a href="https://www.facebook.com/clxidiomas" target="_blank">
            <i class="fab fa-facebook-f"></i>Facebook
          </a>
        </li>
        <li>
          <a href="https://www.instagram.com/clx_idiomas/" target="_blank">
            <i class="fab fa-instagram"></i>Instagram
          </a>
        </li>
      </ul>
  
      <p>
        <strong>Página oficial:</strong><br>
        <a href="https://www.clx.com.mx" target="_blank">
          <i class="fas fa-globe"></i>https://www.clx.com.mx
        </a>
      </p>
    `,
  },
  // Formulario de inscripción
  inscripcion: {
    title: "INSCRIPCIÓN NIVEL A1",
    content: `
      <form id="form-inscripcion" class="inscription-form">
        <h4>Formulario de Inscripción</h4>
        <div id="insc-announcement" class="announcement">
          ⚠️ ¡IMPORTANTE! Abrimos un grupo con al menos 6 alumnos inscritos.<br><br>
          Te recomendamos considerar un horario que ya tenga alumnos inscritos o bien reflexionar sobre otras posibilidades de horario o cambio de idioma (si eres principiante)<br>
        </div>
        <!-- Campos básicos -->
        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input id="nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
        </div>
        <div class="form-group">
          <label for="cuenta_unam">No. de Cuenta/Empleado UNAM</label>
          <input id="cuenta_unam" name="cuenta_unam" type="text" placeholder="Ej: 12345678">
        </div>
        <div class="form-group">
          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="usuario@correo.com" required>
        </div>
        <div class="form-group">
          <label for="whatsapp">WhatsApp</label>
          <input id="whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
        </div>

        <!-- Select tipo → idioma → nivel → horario -->
        <div class="form-group">
          <label for="tipo_curso">Tipo de curso</label>
          <select id="tipo_curso" name="tipo_curso" required>
            <option value="" disabled selected>Elige un tipo…</option>
            <option value="regular">Regular</option>
          </select>
        </div>
        <div class="form-group">
          <label for="idioma">Idioma</label>
          <select id="idioma" name="idioma" required>
            <option value="" disabled selected>Selecciona primero tipo…</option>
          </select>
        </div>
        <div class="form-group">
          <label for="nivel_ingreso">Nivel de ingreso</label>
          <select id="nivel_ingreso" name="nivel_ingreso" required>
            <option value="" disabled selected>Selecciona primero idioma…</option>
          </select>
        </div>
        <div class="form-group">
          <label for="horario">Horario</label>
          <select id="horario" name="horario" required>
            <option value="" disabled selected>Selecciona primero nivel…</option>
          </select>
          <div class="inscritos-info">
            Inscritos en este horario: <span id="inscritos-count-inline">0</span>
          </div>
        </div>
        <div class="form-group" id="horario-otro-group" style="display:none;">
          <label for="horario_otro">Proponer horario</label>
          <input id="horario_otro" name="horario_otro" type="text" placeholder="Escribe tu horario…">
        </div>

        <!-- Selección de periodo -->
        <div class="form-group" id="periodo-group" style="display:none;">
          <label><strong>Periodo del curso</strong></label>
          <div id="periodo-options"></div>
          <input type="hidden" id="fecha_inicio" name="fecha_inicio" required>
          <input type="hidden" id="fecha_fin" name="fecha_fin" required>
        </div>

        <!-- Confirmación -->
        <div class="form-group">
          <input id="confirm_periodo" name="confirm_periodo" type="checkbox" required>
          <label for="confirm_periodo">Confirmo que el periodo seleccionado es correcto</label>
        </div>

        <!-- Mensaje y envío -->
        <div class="form-group full-width">
          <label for="mensaje">Mensaje (opcional)</label>
          <textarea id="mensaje" name="mensaje"
                    placeholder="Escribe tu solicitud de horario, dudas o comentarios aquí…"></textarea>
        </div>

        <button type="submit">Enviar Inscripción</button>
        <div id="insc-feedback" role="alert"></div>
      </form>
    `,
  },
  examen: {
    title: "EXAMEN DE COLOCACIÓN",
    content: `
      <form id="form-examen-colocacion" class="examen-form">
  <h4>Registro Examen de Colocación</h4>

  <div class="form-group">
    <label for="ex_nombre">Nombre</label>
    <input id="ex_nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
  </div>

  <div class="form-group">
    <label for="ex_cuenta">No. de Cuenta/Empleado UNAM</label>
    <input id="ex_cuenta" name="cuenta_unam" type="text" placeholder="Ej: 12345678" required>
  </div>

  <div class="form-group">
    <label for="ex_whatsapp">WhatsApp</label>
    <input id="ex_whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
  </div>

  <div class="form-group">
    <label for="ex_email">E-mail</label>
    <input id="ex_email" name="email" type="email" placeholder="usuario@correo.com" required>
  </div>

  <div class="form-group">
    <label for="ex_idioma">Idioma</label>
    <select id="ex_idioma" name="idioma" required>
      <option value="" disabled selected>Selecciona idioma…</option>
      <option value="ingles">Inglés</option>
      <option value="frances">Francés</option>
    </select>
  </div>

  <button type="submit">Enviar Registro</button>
</form>

<div id="ex-feedback" role="alert"></div>

<p class="note">
  * En breve un ejecutivo se pondrá en contacto contigo para darle seguimiento al proceso de presentación de examen de colocación.
</p>
    `,
  },
  lista: {
  title: "LISTA DE ESPERA",
  content: `
    <form id="form-lista-espera" class="lista-espera-form">
      <h4>Registro Lista de Espera</h4>

      <div class="form-group">
        <label for="le_nombre">Nombre</label>
        <input id="le_nombre" name="nombre" type="text" placeholder="Tu nombre completo" required>
      </div>

      <div class="form-group">
        <label for="le_cuenta">No. de Cuenta/Empleado UNAM</label>
        <input id="le_cuenta" name="cuenta_unam" type="text" placeholder="Ej: 12345678" required>
      </div>

      <div class="form-group">
        <label for="le_whatsapp">WhatsApp</label>
        <input id="le_whatsapp" name="whatsapp" type="tel" placeholder="55 1234 5678" required>
      </div>

      <div class="form-group">
        <label for="le_email">E-mail</label>
        <input id="le_email" name="email" type="email" placeholder="usuario@correo.com" required>
      </div>

      <div class="form-group">
        <label for="le_idioma">Idioma</label>
        <select id="le_idioma" name="idioma" required>
          <option value="" disabled selected>Selecciona idioma…</option>
          <option value="ingles">Inglés</option>
          <option value="frances">Francés</option>
          <option value="aleman">Alemán</option>
          <option value="italiano">Italiano</option>
          <option value="portugues">Portugués</option>
          <option value="japones">Japonés</option>
          <option value="chino">Chino</option>
          <option value="coreano">Coreano</option>
          <option value="esp_extranjeros">Español para extranjeros</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="form-group">
        <label for="le_nivel">Nivel</label>
        <select id="le_nivel" name="nivel" required>
          <option value="" disabled selected>Selecciona nivel…</option>
          <option value="A2">A2</option>
          <option value="B1">B1</option>
          <option value="B2">B2</option>
        </select>
      </div>

      <div class="form-group">
        <label for="le_horario">Horario deseado</label>
        <select id="le_horario" name="horario_deseado" required>
          <option value="" disabled selected>Selecciona horario…</option>
          <option value="por la mañana">Por la mañana</option>
          <option value="a media tarde">A media tarde</option>
          <option value="por la noche">Por la noche</option>
          <option value="fin de semana">En fin de semana</option>
        </select>
      </div>

      <button type="submit">Enviar Solicitud</button>
    </form>

    <div id="le-feedback" role="alert"></div>

    <p class="note">
      * En breve un ejecutivo se pondrá en contacto contigo para darle seguimiento a tu solicitud.
    </p>
  `,
},
};

// 2) DOMContentLoaded: menú lateral + renderizado dinámico
// ————————————————————————————————
document.addEventListener("DOMContentLoaded", () => {
  const rects   = document.querySelectorAll(".course-menu .rect");
  const infoBox = document.getElementById("course-info");

  rects.forEach(rect => {
    rect.addEventListener("click", () => {
      // 1) Desactivar todos
      rects.forEach(r => r.classList.remove("active"));
      // 2) Activar el clicado
      rect.classList.add("active");

      // 3) Renderizar contenido
      const key  = rect.id;
      const data = courseDetails[key];
      infoBox.innerHTML = `<h3>${data.title}</h3>${data.content}`;

      // 4) Si es Inscripción, inicializar TODO
      if (key === "inscripcion") {
        bindFormLogic();
        populatePeriodos();
        attachInscriptionHandler();
        // fuerza el primer change para poblar el select
        document.getElementById("tipo_curso")
                .dispatchEvent(new Event("change"));
      }

      // 5) Si es Examen de Colocación, engancha el AJAX handler
      if (key === "examen") {
        attachExamHandler();
      }

      // 6) Si es Lista de Espera, engancha el AJAX handler
      if (key === "lista") {
        attachListaHandler();
      }

      // 7) Scroll suave
      infoBox.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  });
});

// Diccionario de idiomas
const languageLabels = {
  ingles: "Inglés",
  frances: "Francés",
  aleman: "Alemán",
  italiano: "Italiano",
  portugues: "Portugués",
  japones: "Japonés",
  chino: "Chino",
  coreano: "Coreano",
};

// ————————————————————————————————
// 3) availability: idiomas → niveles → horarios (strings) o bloques { dias, horas }
// ————————————————————————————————
const availability = {
  intensivo: {
    idiomas: {
    ingles: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["07:00-08:00", "08:00-09:00", "14:00-15:00", "17:00-18:00", "20:00-21:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],
      /*
      A2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["07:00-08:00", "13:00-14:00", "20:00-21:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],
      B1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["13:00-14:00", "21:00-22:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],
      B2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["21:00-22:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],*/
    },
    frances: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["07:00-08:00", "08:00-09:00", "17:00-18:00", "20:00-21:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],
      /*
      A2: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: ["07:00-08:00", "13:00-14:00", "21:00-22:00"],
        },
        {
          dias: ["Sáb", "Dom"],
          horas: ["08:00-11:00", "11:00-14:00", "19:30-22:00"],
        },
      ],*/
    },
    aleman: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },
    italiano: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },
    portugues: {
      A1: [
        {
          dias: ["Lun", "Mar", "Mié", "Jue", "Vie"],
          horas: [],
        },
      ],
    },
  },
  },
  regular: {
  idiomas: {
    ingles: {
      'A1': [
        // I. Lunes a viernes
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: [
            '07:00-08:00',
            '08:00-09:00',
            '11:00-12:00',
            '14:00-15:00',
            '17:00-18:00',
            '18:00-19:00',
            '19:00-20:00',
            '20:00-21:00'
          ],
        },
        // II. Sábados y domingos
        {
          dias: ['Sáb', 'Dom'],
          horas: [
            '07:00-09:30',
            '08:00-10:30',
            '09:30-12:00',
            '10:30-13:00',
            '19:00-21:30'
          ],
        }
      ]
    },

    frances: {
      'A1': [
        // I. Lunes a viernes
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: [
            '07:00-08:00',
            '08:00-09:00',
            '13:00-14:00',
            '18:00-19:00',
            '20:00-21:00'
          ],
        },
        // II. Sábados y domingos
        {
          dias: ['Sáb', 'Dom'],
          horas: [
            '07:00-09:30',
            '08:00-10:30',
            '19:30-22:00'
          ],
        }
      ]
    },
    italiano: {
      'A1': [
         // I. Lunes a viernes
        {
          dias: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie'],
          horas: [
            '08:00-09:00',
            '15:00-16:00',
            '18:00-19:00',
            '19:00-20:00',
          ],
        },
        // II. Sábados y domingos
        {
          dias: ['Sáb', 'Dom'],
          horas: [
            '08:00-10:30',
          ],
        }
      ]
    },

    aleman: {
      'A1': [
        // II. Sábados y domingos
        {
          dias: ['Sáb', 'Dom'],
          horas: [
            '19:30-22:00',
          ],
        }
      ]
    }
  }
},
  /*
  iniciacion: {
  idiomas: {
    aleman: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['18:00-19:00'] }
      ]
    },
    arabe: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['19:00-20:00'] }
      ]
    },
    coreano: {
      A1: [
        { dias: ['Mar','Jue'], horas: ['9:00-10:30'] }
      ]
    },
    chino: {
      A1: [
        { dias: ['Lun','Mié','Jue'], horas: ['19:00-20:00'] }
      ]
    },
    
    frances: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['18:00-19:00',] }, 
      ]
    },
    italiano: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['15:00-16:00'] }
      ]
    },
    japones: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['17:00-18:00'] }
      ]
    },
    portugues: {
      A1: [
        { dias: ['Lun','Mié','Vie'], horas: ['11:00-12:00'] }
      ]
    }
  }
},*/
};

// ————————————————————————————————
// 4) populatePeriodos: radios de periodo según tipo_curso
// ————————————————————————————————
function populatePeriodos() {
  const tipo = document.getElementById("tipo_curso").value;
  const cont = document.getElementById("periodo-options");
  const grp = document.getElementById("periodo-group");
  let opts = [];

  if (tipo === "intensivo") {
    opts = [{ label: "18 agosto - 27 octubre", start: "2025-08-18", end: "2025-09-27" }];
  } else if (tipo === "regular") {
    opts = [
      { label: "8 septiembre - 26 noviembre", start: "2025-09-08", end: "2025-11-26" },
    ];
  } else if (tipo === "iniciacion") {
    opts = [{ label: "4 - 31 julio", start: "2025-07-04", end: "2025-07-31" }];
  }

  if (!opts.length) {
    grp.style.display = "none";
    return;
  }
  grp.style.display = "block";

  cont.innerHTML = opts
    .map(
      (o, i) => `
    <div class="radio-option">
      <input type="radio" id="periodo_${i}" name="periodo" 
             value="${o.start}|${o.end}" required>
      <label for="periodo_${i}">${o.label}</label>
    </div>
  `
    )
    .join("");

  opts.forEach((o, i) => {
    document.getElementById(`periodo_${i}`).addEventListener("change", (e) => {
      const [s, f] = e.target.value.split("|");
      document.getElementById("fecha_inicio").value = s;
      document.getElementById("fecha_fin").value = f;
    });
  });

  // auto-select si sólo hay uno
  const r = cont.querySelectorAll('input[type="radio"]');
  if (r.length === 1) {
    r[0].checked = true;
    r[0].dispatchEvent(new Event("change"));
  }
}

// ————————————————————————————————
// 5) bindFormLogic: manejamos selects y “otro…” + fetch de count
// ————————————————————————————————
function bindFormLogic() {
  const form = document.getElementById("form-inscripcion");
  const tipo = form.tipo_curso;
  const idioma = form.idioma;
  const nivel = form.nivel_ingreso;
  const horario = form.horario;
  const otroGrp = document.getElementById("horario-otro-group");
  const otroInp = document.getElementById("horario_otro");
  const inlineCount = document.getElementById("inscritos-count-inline");

  const placeholder = txt => `<option value="" disabled selected>${txt}</option>`;

  tipo.addEventListener("change", () => {
    const langs = Object.keys(availability[tipo.value]?.idiomas || {});
    idioma.innerHTML = langs.length
      ? [placeholder("Selecciona un idioma…"), ...langs.map(l => {
          const label = languageLabels[l] || l;
          return `<option value="${l}">${label}</option>`;
        })].join("")
      : placeholder("Selecciona tipo primero…");
    nivel.innerHTML = placeholder("Idioma primero…");
    horario.innerHTML = placeholder("Nivel primero…");
    populatePeriodos();
  });

  idioma.addEventListener("change", () => {
    const lvls = Object.keys(availability[tipo.value]?.idiomas[idioma.value] || {});
    nivel.innerHTML = lvls.length
      ? [placeholder("Selecciona un nivel…"), ...lvls.map(v => `<option value="${v}">${v}</option>`)].join("")
      : placeholder("Primero elige idioma…");
    horario.innerHTML = placeholder("Nivel primero…");
  });

  nivel.addEventListener("change", () => {
    const conf = availability[tipo.value]?.idiomas[idioma.value]?.[nivel.value] || [];
    populateHorarios(conf, horario, placeholder);
  });

  horario.addEventListener("change", () => {
    if (horario.value === "otro") {
      otroGrp.style.display = "block";
      otroInp.required = true;
      return;
    }
    otroGrp.style.display = "none";
    otroInp.required = false;
    otroInp.value = "";

    const params = new URLSearchParams({
      tipo_curso: tipo.value,
      idioma: idioma.value,
      nivel_ingreso: nivel.value,
      horario: horario.value
    });
    fetch(`/api/inscripciones/count/?${params}`)
      .then(r => r.json())
      .then(json => inlineCount.textContent = json.count)
      .catch(() => inlineCount.textContent = "0");
  });

  tipo.dispatchEvent(new Event("change"));
}

// 6) populateHorarios: construye <option> de horarios
function populateHorarios(conf, selectEl, placeholder) {
  let opts = [placeholder("Selecciona un horario…")];
  if (conf.length && typeof conf[0] === "string") {
    conf.forEach(h => opts.push(`<option value="${h}">${h}</option>`));
  } else {
    conf.forEach(block => {
      block.horas.forEach(h => {
        opts.push(`<option value="${h}">${block.dias.join(", ")} — ${h}</option>`);
      });
    });
  }
  opts.push('<option value="otro">Otro…</option>');
  selectEl.innerHTML = opts.join("");
}

// 7) attachInscriptionHandler: AJAX de inscripción
function attachInscriptionHandler() {
  const form     = document.getElementById("form-inscripcion");
  const feedback = document.getElementById("insc-feedback");
  const btn      = form.querySelector('button[type="submit"]');

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";
    btn.disabled = true;

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/inscripcion/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.classList.add("success");
      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
      btn.disabled = false;
    }
  });
}

// 8) attachExamHandler: AJAX de examen de colocación
function attachExamHandler() {
  const form     = document.getElementById("form-examen-colocacion");
  const feedback = document.getElementById("ex-feedback");

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/examen-colocacion/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
    }
  });
}

// 9) attachListaHandler: AJAX de lista de espera
function attachListaHandler() {
  const form     = document.getElementById("form-lista-espera");
  const feedback = document.getElementById("le-feedback");

  form.addEventListener("submit", async e => {
    e.preventDefault();
    feedback.className = "";
    feedback.textContent = "Procesando…";

    const data = Object.fromEntries(new FormData(form).entries());
    try {
      const res = await fetch("/api/lista-espera/", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Error ${res.status}`);
      const json = await res.json();
      if (json.status !== "ok") throw new Error(json.message);

      feedback.textContent = json.message;
      form.reset();
    } catch (err) {
      feedback.classList.add("error");
      feedback.textContent = err.message;
    }
  });
}